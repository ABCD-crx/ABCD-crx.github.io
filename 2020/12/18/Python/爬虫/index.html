

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/loge/loge.png">
  <link rel="icon" href="/img/loge/loge.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#000000">
  <meta name="author" content="Crx">
  <meta name="keywords" content="C,C++,Java,Vue,Linux,Docker">
  
    <meta name="description" content="Python网络爬虫——一念神魔">
<meta property="og:type" content="article">
<meta property="og:title" content="Python爬虫">
<meta property="og:url" content="http://example.com/2020/12/18/Python/%E7%88%AC%E8%99%AB/index.html">
<meta property="og:site_name" content="Chenrx&#39;s Blog">
<meta property="og:description" content="Python网络爬虫——一念神魔">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/blog/spider.png">
<meta property="article:published_time" content="2020-12-18T01:24:45.000Z">
<meta property="article:modified_time" content="2024-02-24T10:47:36.392Z">
<meta property="article:author" content="Crx">
<meta property="article:tag" content="python">
<meta property="article:tag" content="爬虫">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/blog/spider.png">
  
  
  
  <title>Python爬虫 - Chenrx&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Chenrx&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background/background3.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Python爬虫"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-12-18 09:24" pubdate>
          2020年12月18日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          103 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Python爬虫</h1>
            
              <p id="updated-time" class="note note-info" style="display: none">
                
                  
                    本文最后更新于 2024-02-24T18:47:36+08:00
                  
                  

                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="python爬虫"><a href="#python爬虫" class="headerlink" title="python爬虫"></a>python爬虫</h1><p>什么是爬虫</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-number">1.</span>通过一个程序，根据<span class="hljs-built_in">url</span>进行爬取网页，获取有用信息<br><span class="hljs-number">2.</span>使用程序模拟浏览器，去向服务器发送请求，获取相应信息<br></code></pre></td></tr></table></figure>

<p>核心</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">1.爬取网页：爬取整个网页，包含网页中所有的内容<br>2.解析数据：将网页中你得到的数据 进行解析<br>3.难点，爬虫与反爬虫之间的博弈<br></code></pre></td></tr></table></figure>

<p>用途</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">数据分析/人工数据集 <br></code></pre></td></tr></table></figure>

<p>分类</p>
<p>通用爬虫</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">通用爬虫：<br>	实例<br>		百度、<span class="hljs-number">360</span>、google、sougou等搜索引擎‐‐‐伯乐在线<br>	功能<br>		访问网页‐&gt;抓取数据‐&gt;数据存储‐&gt;数据处理‐&gt;提供检索服务<br>	robots协议<br>		一个约定俗成的协议，添加robots.txt文件，来说明本网站哪些内容不可以被抓取，起不到限制作用<br>		<span class="hljs-comment">#自己写的爬虫无需遵守</span><br>	网站排名(SEO)<br>		<span class="hljs-number">1.</span> 根据pagerank算法值进行排名（参考个网站流量、点击率等指标）<br>		<span class="hljs-number">2.</span> 百度竞价排名<br>	缺点<br>		<span class="hljs-number">1.</span> 抓取的数据大多是无用的<br>		<span class="hljs-number">2.</span>不能根据用户的需求来精准获取数据<br></code></pre></td></tr></table></figure>

<p>聚焦爬虫</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">根据需求，实现爬虫程序，抓取需要的数据<br>设计思路<br>	<span class="hljs-number">1</span>.确定要爬取的url<br>	<span class="hljs-number">2</span>.模拟浏览器通过http协议访问url，获取服务器返回的<span class="hljs-selector-tag">html</span>代码<br>	<span class="hljs-number">3</span>.解析<span class="hljs-selector-tag">html</span>代码（根据一定规则提取需要的数据）<br></code></pre></td></tr></table></figure>



<h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;！DOCTYPE html&gt; 声明为html5文档<br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    	头部信息...<br>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span> = <span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span> 页面标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--  table 表格 tr 行 td列--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span> 可见文档主体<br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> 段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>html 超文本标记语言  <strong>H</strong>yper<strong>T</strong>ext <strong>M</strong>arkup <strong>L</strong>anguage<br>html文档也叫做web页面</p>
<p>doctype 声明是不区分大小写的，用来告知 Web 浏览器页面使用了哪种 HTML 版本</p>
<p>web浏览器用于读取html文件，并将其作为网页显示</p>
<h3 id="html元素"><a href="#html元素" class="headerlink" title="html元素"></a>html元素</h3><p>html 标题<br>    通过<h1> - <h6>来定义</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>一级标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>二级标题<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>... 逐级递减<br></code></pre></td></tr></table></figure>

<p>html 段落	<p>来定义</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是另外一个段落。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>html 连接  标签<a>来定义</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.runoob.com&quot;</span>&gt;</span>这是一个链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>html 图像 通过 <img>来定义</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">&quot;lazy&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/images/logo.png&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;258&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;39&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<p>图像的名称和尺寸以属性形式提供</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- ul li 无序列表 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>喵喵喵<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>汪汪汪<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- ol li	有序列表 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span> 第一步<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span> 第二步<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="url编码"><a href="#url编码" class="headerlink" title="url编码"></a>url编码</h4><p>编码的格式为：%加字符的ASCII码，即一个百分号%，后面跟对应字符的ASCII（16进制）码值。例如空格的编码值是”%20”</p>
<p>先转ASCII码，在转16进制</p>
<h2 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h2><h3 id="urllib库基本使用"><a href="#urllib库基本使用" class="headerlink" title="urllib库基本使用"></a>urllib库基本使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">urllib.request.urlopen() 模拟浏览器向服务器发送请求<br>response 服务器返回的数据<br>	response的数据类型是HttpResponse<br>	字节‐‐&gt;字符串<br>			解码decode<br>	字符串‐‐&gt;字节<br>			编码encode<br>       read() 字节形式读取二进制 扩展：rede(<span class="hljs-number">5</span>)返回前几个字节<br>       readline() 读取一行<br>       readlines() 一行一行读取 直至结束<br>       getcode() 获取状态码<br>       geturl() 获取url<br>       getheaders() 获取headers<br><br>   urllib.request.urlretrieve() <span class="hljs-comment">#下载</span><br>       请求网页<br>       请求图片<br>       请求视频<br></code></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request<br><br>url = <span class="hljs-string">&#x27;http://www.daidu.com&#x27;</span><br><span class="hljs-comment"># url = &#x27;https://fanyi.baidu.com&#x27;</span><br><span class="hljs-comment"># 模拟浏览器向服务器发送请求</span><br>response = urllib.request.urlopen(url)<br><br><span class="hljs-comment"># 获取相应中的页面源码</span><br>    <span class="hljs-comment">#read方法 返回的是字节形式的二进制数据</span><br>    <span class="hljs-comment">#将二进制的数据转换为字符串，解码 decode(“utf-8”)</span><br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure>

<h4 id="一个类型"><a href="#一个类型" class="headerlink" title="一个类型"></a>一个类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">response = urllib.request.urlopen(url)<br>ptint (<span class="hljs-built_in">type</span>(response))<br><span class="hljs-comment"># response 是HTTPResponse类型</span><br></code></pre></td></tr></table></figure>

<h4 id="六个方法"><a href="#六个方法" class="headerlink" title="六个方法"></a>六个方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">content = response.read()	<span class="hljs-comment">#read()按字节读取</span><br><br>content = response.readline() <span class="hljs-comment">#readline 读取一行</span><br><br>content = response.readlines() <span class="hljs-comment">#按行读取到结束</span><br><br><span class="hljs-comment">#返回状态码 </span><br><span class="hljs-built_in">print</span>(response.getcode()) <span class="hljs-number">200</span>访问成功<br><br><span class="hljs-comment">#返回url地址</span><br><span class="hljs-built_in">print</span>(response.geturl())<br><br><span class="hljs-comment">#获取状态信息</span><br><span class="hljs-built_in">print</span>(response.getheaders())<br></code></pre></td></tr></table></figure>

<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>urlretrieve(url , filename)</p>
<p>url代表 下载路径，filename保存文件名字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">url_page = <span class="hljs-string">&#x27;http://baidu.com&#x27;</span><br>urllib.request.urlretrieve(url_page,<span class="hljs-string">&#x27;baidu.html&#x27;</span>)<br><br>url_img = <span class="hljs-string">&#x27;&#x27;</span><br>urllib.request.urlretrieve(url_img, <span class="hljs-string">&#x27;jxy.jpg&#x27;</span>)<br><br>url_video = <span class="hljs-string">&#x27;&#x27;</span><br>urllib.request.urlretrieve(url_video,<span class="hljs-string">&#x27;jxy.mp4&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="请求对象的定制"><a href="#请求对象的定制" class="headerlink" title="请求对象的定制"></a>请求对象的定制</h3><p>请求对象的定制是解决反爬 的第一种手段</p>
<p>url组成</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">https</span>://www.baidu.com/s?wd=xxx<br><br><span class="hljs-keyword">http</span>/<span class="hljs-keyword">https</span>    www.baidu.com    <span class="hljs-number">80</span>/<span class="hljs-number">443</span>     s    wd=xxx    <span class="hljs-comment">#</span><br>   协议			域名/主机		端口号    路径     参数    锚点<br>   <br><span class="hljs-keyword">http</span> <span class="hljs-number">80</span>		<span class="hljs-keyword">https</span> <span class="hljs-number">443</span><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">UA介绍：Uesr Agent 用户代理，它是一个特殊字符串头，使得服务器能够识别客户使用的操作系统及版本，CPU 类型，浏览器及版本。<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">语法：request = urllib.requset.Request()<br></code></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> urllib.request<br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;user-agent&#x27;</span>:<span class="hljs-string">&#x27; Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br>&#125;<br><br>response = urllib.request.urlopen(url,headers) <span class="hljs-comment">#错误写法</span><br><br><span class="hljs-comment">#因为urlopen 方法中不能存储字典，所以headers不能传递进去，可以传递Request对象</span><br>  则需要请求对象的定制<br>    <br>url = <span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span><br><span class="hljs-number">1.</span>请求对象的定制<br>request = urllib.request.Request(url = url ,headers= headers)<br><span class="hljs-comment">#注意 因为参数顺序的问题 不能直接写url 和headers 中间还有data参数，所以我们需要关键字传参</span><br><br><span class="hljs-number">2.</span>模拟浏览器向服务器发送请求<br>response = urllib.request.urlopen(request)<br><br><span class="hljs-number">3.</span>获取响应内容<br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-number">4.</span>打印数据<br><span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure>

<h3 id="get请求（编解码）"><a href="#get请求（编解码）" class="headerlink" title="get请求（编解码）"></a>get请求（编解码）</h3><h4 id="1-get请求方式：urllib-parse-quote"><a href="#1-get请求方式：urllib-parse-quote" class="headerlink" title="1.get请求方式：urllib.parse.quote( )"></a>1.get请求方式：urllib.parse.quote( )</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">UnicodeEncodeError: <span class="hljs-string">&#x27;ascii&#x27;</span> codec can<span class="hljs-string">&#x27;t encode characters in position 10-12: ordinal not in range(128)</span><br></code></pre></td></tr></table></figure>

<p>不同类型编码，在一起无法识别，转为unicode编码的格式</p>
<p>依赖于	urllib.parse</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.parse<br><br>name = urllib.parse.quote(<span class="hljs-string">&#x27;毛不易&#x27;</span>) <span class="hljs-comment">#将其转为unicode编码</span><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request<br><span class="hljs-keyword">import</span> urllib.parse<br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br><br>    &#125;<br>url = <span class="hljs-string">&#x27;https://www.baidu.com/s?wd=&#x27;</span><br>name = urllib.parse.quote(<span class="hljs-string">&#x27;毛不易&#x27;</span>)<br>url = url + name<br><br>request = urllib.request.Request(url = url ,headers= headers)<br><br>response = urllib.request.urlopen(request)<br><br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure>

<h4 id="2-get请求方式：urllib-parse-urlencode"><a href="#2-get请求方式：urllib-parse-urlencode" class="headerlink" title="2.get请求方式：urllib.parse.urlencode"></a>2.get请求方式：urllib.parse.urlencode</h4><p>urlencode应用场景：多个参数的时候</p>
<p>‘ wd&#x3D; ‘搜索 ：将中文转为urlencode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  urllib.request<br><span class="hljs-keyword">import</span>  urllib.parse<br>date =&#123;<br>    <span class="hljs-string">&#x27;wd&#x27;</span>:<span class="hljs-string">&#x27;毛不易&#x27;</span>,<br>    <span class="hljs-string">&#x27;sex&#x27;</span>:<span class="hljs-string">&#x27;男&#x27;</span><br>&#125;<br>base_url = <span class="hljs-string">&#x27;https://www.baidu.com/s?&#x27;</span><br><br>******new_date = urllib.parse.urlencode(date) <br><br>url = base_url + new_date<br><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br> &#125;<br><span class="hljs-comment">#请求对象的定制</span><br>request = urllib.request.Request(url = url,headers = headers)<br><span class="hljs-comment">#模拟浏览器发送请求</span><br>response = urllib.request.urlopen(request)<br><span class="hljs-comment">#获取网页源码</span><br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(content)<br><br></code></pre></td></tr></table></figure>

<h4 id="3-post请求"><a href="#3-post请求" class="headerlink" title="3.post请求"></a>3.post请求</h4><p>post请求需要传递参数</p>
<p>urlencode 解码 后需要encode编码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#post 请求方式的参数 必须解码</span><br>data = urllib.parse.urlencode(data)<br><br><span class="hljs-comment">#编码之后 必须调用encode方法 </span><br>	(requset data参数接收字节变量，unicode编码是<span class="hljs-built_in">str</span>类型)<br>data = urllib.parse.urlencode(data).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-comment">#参数是放在请求对象定制的方法中</span><br>request = urllib.request.Request(url = url,data = data, headers =  headers)<br><br></code></pre></td></tr></table></figure>

<p>eg.百度翻译实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> urllib.request<br><br>url = <span class="hljs-string">&#x27;https://fanyi.baidu.com/sug&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br> &#125;<br><br>keyword = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入要翻译的内容&quot;</span>)<br>data = &#123;<br>    <span class="hljs-string">&#x27;kw&#x27;</span>:keyword<br>&#125;<br><br><span class="hljs-comment">#post请求的参数，必须要进行encode编码</span><br>data = urllib.parse.urlencode(data).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-comment">#post的请求的参数 是不会拼接在url后面的，而是放在请求对象的定制的参数中</span><br><span class="hljs-comment">#post请求的参数 必须要进行编码</span><br><br>request = urllib.request.Request(url = url ,data= data,headers=headers)<br>response = urllib.request.urlopen(request)<br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>content 类型为<span class="hljs-built_in">str</span>  不可读<br>json字符串 转为 json对象 则为正常中文编码<br><span class="hljs-comment">#字符串 ———》 json对象</span><br><br><span class="hljs-keyword">import</span> json<br>obj = json.loads(content)<br><span class="hljs-built_in">print</span>(obj)<br></code></pre></td></tr></table></figure>

<p>总节：post和get区别？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span>：get请求方式的参数必须编码，参数是拼接到url后面，编码之后不需要调用encode方法<br><span class="hljs-number">2</span>：post请求方式的参数必须编码，参数是放在请求对象定制的方法中，编码之后需要调用encode方法<br></code></pre></td></tr></table></figure>



<p>案例：百度翻译详细翻译</p>
<p>反爬机制 Cookie 和 token 认证（常理应该解决，但仍无法爬取）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure>



<h3 id="ajax的get请求"><a href="#ajax的get请求" class="headerlink" title="ajax的get请求"></a>ajax的get请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">当在headers中看到<br><span class="hljs-string">&#x27;X-Requested-With: XMLHttpRequest&#x27;</span><br>则为ajax请求<br></code></pre></td></tr></table></figure>

<p>豆瓣电影</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#爬取豆瓣电影前10页数据</span><br><br><br><span class="hljs-comment">#下载豆瓣电影前10页的数据</span><br><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> urllib.request<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_request</span>(<span class="hljs-params">page</span>):<span class="hljs-comment">#1.请求对象定制</span><br>    base_url = <span class="hljs-string">&#x27;https://movie.douban.com/j/chart/top_list?type=20&amp;interval_id=100%3A90&amp;action=&amp;&#x27;</span><br><br>    headers = &#123;<br>        <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br>    &#125;<br><br>    base_date = &#123;<br>        <span class="hljs-string">&#x27;start&#x27;</span> : (page - <span class="hljs-number">1</span>) * <span class="hljs-number">20</span>,<br>        <span class="hljs-string">&#x27;limit&#x27;</span> : <span class="hljs-number">20</span><br>    &#125;<br><br>    date = urllib.parse.urlencode(base_date)<br><br>    url = base_url + date<br><br>    requset = urllib.request.Request(url = url , headers= headers)<br><br>    <span class="hljs-keyword">return</span> requset<br><br><span class="hljs-comment">#获取响应内容</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">request</span>): <br>    response = urllib.request.urlopen(request)<br>    content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-keyword">return</span> content<br><br><span class="hljs-comment">#下载</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">down_load</span>(<span class="hljs-params">content</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;douban.json&#x27;</span>,<span class="hljs-string">&#x27;a+&#x27;</span>,encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        file.write(content)<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    start_page = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入起始的页码&#x27;</span>))<br>    end_page = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入结束的页面&#x27;</span>))<br><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start_page,end_page+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment">#每一页都要有自己的请求对象定制</span><br>        request = create_request(page)<br>        content = get_content(request)<br>        down_load(content)<br><br></code></pre></td></tr></table></figure>

<h3 id="ajax的post请求"><a href="#ajax的post请求" class="headerlink" title="ajax的post请求"></a>ajax的post请求</h3><p>案例：KFC官网地址信息获取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request<br><span class="hljs-keyword">import</span> urllib.parse<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_request</span>(<span class="hljs-params">page</span>):<br>    base_url = <span class="hljs-string">&#x27;http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname&#x27;</span><br><br>    headers = &#123;<br>        <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br>    &#125;<br><br>    data = &#123;<br>        <span class="hljs-string">&#x27;cname&#x27;</span>: <span class="hljs-string">&#x27;西安&#x27;</span>,<br>        <span class="hljs-string">&#x27;pid&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>        <span class="hljs-string">&#x27;pageIndex&#x27;</span>: page ,<br>        <span class="hljs-string">&#x27;pageSize&#x27;</span>: <span class="hljs-string">&#x27;10&#x27;</span><br>    &#125;<br>    data = urllib.parse.urlencode(data).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>    request = urllib.request.Request(url= base_url , data = data , headers= headers)<br>    <span class="hljs-keyword">return</span>  request<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_content</span>(<span class="hljs-params">request</span>):<br>    response = urllib.request.urlopen(request)<br><br>    content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)  ******<br>    <span class="hljs-keyword">return</span> content<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">down_load</span>(<span class="hljs-params">content</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;kcf.json&#x27;</span>,<span class="hljs-string">&#x27;a+&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        file.write(content)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    start_page = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入起始的页码&#x27;</span>))<br>    end_page = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入结束的页面&#x27;</span>))<br><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start_page,end_page+<span class="hljs-number">1</span>):<br>        request = create_request(page)<br>        content = get_content(request)<br>        down_load(content)<br><br></code></pre></td></tr></table></figure>

<h3 id="爬虫异常"><a href="#爬虫异常" class="headerlink" title="爬虫异常"></a>爬虫异常</h3><p>URLError\HTTPError</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">简介:<span class="hljs-number">1.</span>HTTPError类是URLError类的子类<br>	<span class="hljs-number">2.</span>导入的包urllib.error.HTTPError urllib.error.URLError<br>	<span class="hljs-number">3.</span>http错误：http错误是针对浏览器无法连接到服务器而增加出来的错误提示。引导并告诉浏览者该页是哪里出了问题。<br>	<span class="hljs-number">4.</span>通过urllib发送请求的时候，有可能会发送失败，这个时候如果想让你的代码更加的健壮，可以通过<span class="hljs-keyword">try</span>‐<span class="hljs-keyword">except</span>进行捕获异常，异常有两类，URLError\HTTPError<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request<br><span class="hljs-keyword">import</span> urllib.error<br><br>url = <span class="hljs-string">&#x27;http://jwxt1.xsyu.edu.cn/eams/login.action1&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br> &#125;<br><span class="hljs-keyword">try</span>:<br>    request = urllib.request.Request(url = url , headers = headers )<br><br>    response = urllib.request.urlopen(request)<br><br>    content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>    <span class="hljs-built_in">print</span> (content)<br><span class="hljs-keyword">except</span> urllib.error.HTTPError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;不想理你。。&#x27;</span>)<br><span class="hljs-keyword">except</span> urllib.error.URLError:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;就是不想理你。。&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="cookie登录"><a href="#cookie登录" class="headerlink" title="cookie登录"></a>cookie登录</h3><p>适用场景：数据采集的时候 需要绕过登录 然后进入到某个页面</p>
<p>反爬手段：个人信息页面是utf-8  但是还报了编码错误  因为没有进入到个人信息页面  而是跳转到了登录页面，登录页面不是utf-8所以报错</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">cookie 中携带着登录信息，如果有登录后的cookie，那么我们就可以携带着cookie进入到任何页面<br><br><span class="hljs-built_in">ref</span>erer 一般情况下做图片的防盗链 <br>	判断当前路径是不是由上一个路径来的  微博有时需要验证有时不需要<br></code></pre></td></tr></table></figure>

<p>案例：微博登录页面 和 qq空间登录</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">qq空间登录 <span class="hljs-selector-tag">html</span> 文件获取正常<br>微博 <span class="hljs-selector-tag">html</span> 获取到，但无法打开 显示获取数据失败 代码见cookie登录<br></code></pre></td></tr></table></figure>



<h3 id="handler处理器"><a href="#handler处理器" class="headerlink" title="handler处理器"></a>handler处理器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">为什么要学习handler？<br>		urllib.request.urlopen(url)<br>		不能定制请求头<br>		urllib.request.Request(url,headers,data)<br>		可以定制请求头  <span class="hljs-comment">#都是静态cookie</span><br>	Handler<br>		定制更高级的请求头（随着业务逻辑的复杂 请求对象的定制已经满足不了我们的需求（动态cookie和代理不能使用请求对象的定制）<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request<br>url = <span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br>&#125;<br><br>request = urllib.request.Request(url = url , headers = headers)<br><br><span class="hljs-comment">#   1.获取hanlder对象</span><br>handler = urllib.request.HTTPHandler()<br><span class="hljs-comment">#   2.获取opener对象</span><br>opener = urllib.request.build_opener(handler)<br><span class="hljs-comment">#   3.调用open方法</span><br>response = opener.<span class="hljs-built_in">open</span>(request)<br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure>

<h3 id="代理服务器"><a href="#代理服务器" class="headerlink" title="代理服务器"></a>代理服务器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>代理的常用功能?<br>	<span class="hljs-number">1.</span>突破自身IP访问限制，访问国外站点。<br>	<span class="hljs-number">2.</span>访问一些单位或团体内部资源<br>			扩展：某大学FTP(前提是该代理地址在该资源的允许访问范围之内)，使用教育网内地址段免费代理服务<br>器，就可以用于对教育网开放的各类FTP下载上传，以及各类资料查询共享等服务。<br>	<span class="hljs-number">3.</span>提高访问速度<br>		扩展：通常代理服务器都设置一个较大的硬盘缓冲区，当有外界的信息通过时，同时也将其保存到缓冲区中，当其他用户再访问相同的信息时， 则直接由缓冲区中取出信息，传给用户，以提高访问速度。<br>	<span class="hljs-number">4.</span>隐藏真实IP<br>		扩展：上网者也可以通过这种方法隐藏自己的IP，免受攻击。<br>	<span class="hljs-number">2.</span>代码配置代理<br>        创建Reuqest对象<br>        创建ProxyHandler对象<br>        用handler对象创建opener对象<br>        使用opener.<span class="hljs-built_in">open</span>函数发送请求<br><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request<br>url = <span class="hljs-string">&#x27;http://cn.bing.com/search?q=ip&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br>&#125;<br><br>request = urllib.request.Request(url = url , headers = headers<br>                                 <br>proxies = &#123;<span class="hljs-string">&#x27;http&#x27;</span>:<span class="hljs-string">&#x27;220.135.165.38:8080&#x27;</span>&#125;<br>handler = urllib.request.ProxyHandler(proxies= proxies)<br>                                 <br>opener = urllib.request.build_opener()<br>response = opener.<span class="hljs-built_in">open</span>(request)<br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;daili.html&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>    file.write(content)<br></code></pre></td></tr></table></figure>

<h4 id="代理池"><a href="#代理池" class="headerlink" title="代理池"></a>代理池</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">proxies_pool = [<br>    &#123;<span class="hljs-string">&#x27;http&#x27;</span>:<span class="hljs-string">&#x27;220.135.165.38:2770&#x27;</span>&#125;,<br>    &#123;<span class="hljs-string">&#x27;http&#x27;</span>:<span class="hljs-string">&#x27;220.135.165.38:8080&#x27;</span>&#125;,<br>]<br><br><span class="hljs-keyword">import</span> random<br><br>proxies = random.choice(proxies_pool)<br><span class="hljs-comment">#每次在代理池中，随机使用一个ip</span><br></code></pre></td></tr></table></figure>





<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><h3 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h3><p>xpath使用</p>
<p>​		安装xpath helper 插件</p>
<p>​		如果使用edge浏览器 下载插件 可以从 <a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/category/extensions?hl=zh-CN">Chrome Web Store</a> 获取 edge基于Chromium基础上做的，应该是可以使用</p>
<p>​		安装成功 ctrl + shift + X 出现 黑框</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>安装lxml库<br>		pip install lxml ‐i https://pypi.douban.com/simple<br><span class="hljs-number">2.</span>导入lxml.etree<br>		<span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><span class="hljs-number">3.</span>etree.parse() 解析本地文件<br>		html_tree = etree.parse(<span class="hljs-string">&#x27;XX.html&#x27;</span>)<br><span class="hljs-number">4.</span>etree.HTML() 服务器响应文件<br>		html_tree = etree.HTML(response.read().decode(<span class="hljs-string">&#x27;utf‐8&#x27;</span>)<br><span class="hljs-number">4.</span>html_tree.xpath(xpath路径)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">xpath基本语法：<br>	<span class="hljs-number">1.</span>路径查询<br>        //：查找所有子孙节点，不考虑层级关系 <span class="hljs-comment">#无限嵌套</span><br>        / ：找直接子节点<br>	<span class="hljs-number">2.</span>谓词查询<br>        //div[@<span class="hljs-built_in">id</span>]<br>        //div[@<span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;maincontent&quot;</span>]<br>    <span class="hljs-number">3.</span>属性查询<br>            //@<span class="hljs-keyword">class</span><br>    <span class="hljs-number">4.</span>模糊查询<br>            //div[contains(@<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;he&quot;</span>)]<br>            //div[starts‐<span class="hljs-keyword">with</span>(@<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;he&quot;</span>)]<br>    <span class="hljs-number">5.</span>内容查询<br>            //div/h1/text()<br>    <span class="hljs-number">6.</span>逻辑运算 			<br>            //div[@<span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;head&quot;</span> <span class="hljs-keyword">and</span> @<span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;s_down&quot;</span>]<br>        		与<span class="hljs-comment">#不能跨标签使用</span><br>            //title | //price<br>            	或<span class="hljs-comment">#只能针对标签使用</span><br>/text()查看内容以中文显示<br></code></pre></td></tr></table></figure>

<p>eg.xpath 解析本地文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br><span class="hljs-comment"># xpath 解析</span><br><span class="hljs-comment">#     (1)本地文件                                             etree.parse</span><br><span class="hljs-comment">#     (2)服务器响应数据 response.read().decode(&#x27;utf-8&#x27;)        etree.HTML()</span><br><span class="hljs-comment">#      xpath 严格遵守html要求所有标签必须成对出现</span><br><span class="hljs-comment">#xpath解析本地文件</span><br>tree = etree.parse(<span class="hljs-string">&#x27;12.xpath_基本使用.html&#x27;</span>)<br><br><span class="hljs-comment"># tree.xpath(&#x27;xpath路径‘)</span><br><br><span class="hljs-comment">#1.查找ul下面的li</span><br><span class="hljs-comment"># li_list = tree.xpath(&#x27;//body//li&#x27;)</span><br><br><span class="hljs-comment"># //是匹配 子 孙 节点   /只是匹配子节点</span><br><br><span class="hljs-comment">#2.查找所有有id属性的li标签   [@属性名]</span><br><span class="hljs-comment"># li_list = tree.xpath(&#x27;//ul/li[@id]&#x27;)</span><br><br><span class="hljs-comment">#3.text()获取标签中的内容</span><br>li_list = tree.xpath(<span class="hljs-string">&#x27;//ul/li[@id]/text()&#x27;</span>)<br><br><span class="hljs-comment">#4.找到id为l1的li标签  注意引号的问题</span><br>li_list = tree.xpath(<span class="hljs-string">&#x27;//ul/li[@id=&quot;l1&quot;]/text()&#x27;</span>)<br><br><span class="hljs-comment">#5.查找到id为l1的li标签的class的属性值</span><br>li = tree.xpath(<span class="hljs-string">&#x27;//ul/li[@id=&quot;l1&quot;]/@class&#x27;</span>)<br><span class="hljs-built_in">print</span>(li)<br><br><span class="hljs-comment">#6.查找id中包含l的li标签   #模糊查询 contains 包含</span><br>li_list = tree.xpath(<span class="hljs-string">&#x27;//ul/li[contains(@id,&quot;l&quot;)]/text()&#x27;</span>)<br><br><span class="hljs-comment">#7.查找id的值以c开头的li标签  #starts-with 以什么开头</span><br>li_list = tree.xpath(<span class="hljs-string">&#x27;//ul/li[starts-with(@id,&quot;c&quot;)]/text()&#x27;</span>)<br><br><span class="hljs-comment">#8.查询id为l1和class 为c1的标  # 不能跨标签使用</span><br>li_list = tree.xpath(<span class="hljs-string">&#x27;//ul/li[@id=&quot;l1&quot; and @class=&quot;c1&quot;]/text()&#x27;</span>)<br><br><span class="hljs-comment">#9.查询id为l1 和 id为 c1</span><br><br>li_list = tree.xpath(<span class="hljs-string">&#x27;//ul/li[@id=&quot;l1&quot;]/text() | //ul/li[@id=&quot;c1&quot;]/text()&#x27;</span>)<br><span class="hljs-comment">#   判断列表的长度</span><br><span class="hljs-built_in">print</span>(li_list)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(li_list))<br><br></code></pre></td></tr></table></figure>

<p>xpath 解析服务器响应数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取百度_百度一下</span><br>出现问题 前期UA错误 导致源码获取与网页查询不一致，重新获取UA即可<br>linux 和 win的源码标签有区别<br><br>xpath 路径获取可以通过右键直接复制<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.request<br><br>url = <span class="hljs-string">&#x27;https://www.baidu.com/&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36 Edg/97.0.1072.55&#x27;</span><br> &#125;<br><br>request = urllib.request.Request(url = url ,headers = headers)<br>response = urllib.request.urlopen(request)<br>content = response.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;baidu.html&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file :<br>     file.write(content)<br><span class="hljs-comment"># print(content)</span><br><br><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<br><br>tree = etree.HTML(content)<br><br>result = tree.xpath(<span class="hljs-string">&#x27;//input[@id=&quot;su&quot;]/@value&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(result)<br><br><br></code></pre></td></tr></table></figure>

<p>应用案例：1.站长素材照片爬取    ——照片的懒加载</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">down_load</span>(<span class="hljs-params">content</span>):<br>    <span class="hljs-comment">#下载图片</span><br>    tree = etree.HTML(content)<br>    name_list = tree.xpath(<span class="hljs-string">&#x27;//div[@id=&quot;container&quot;]//a/img/@alt&#x27;</span>)<br>    <span class="hljs-comment">#一般设计图片的网站都会进行懒加载</span><br>    src_list = tree.xpath(<span class="hljs-string">&#x27;//div[@id=&quot;container&quot;]//a/img/@src2&#x27;</span>)<br>    <span class="hljs-comment"># print(len(name_list),len(src_list))</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(name_list)):<br>        name = name_list[i]<br>        src = src_list[i]<br>        url = <span class="hljs-string">&#x27;https:&#x27;</span> + src<br><br>        url = url.replace(<span class="hljs-string">&#x27;_s&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-comment"># print(name , url )</span><br>        urllib.request.urlretrieve(url = url , filename = <span class="hljs-string">&#x27;../miao/&#x27;</span> + name + <span class="hljs-string">&#x27;.jpg&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="JsonPath"><a href="#JsonPath" class="headerlink" title="JsonPath"></a>JsonPath</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">jsonpath的安装及使用方式：<br>		pip安装：<br>			pip install jsonpath<br>		jsonpath的使用：<br>            obj = json.load(<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;json文件&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf‐8&#x27;</span>))<br>            ret = jsonpath.jsonpath(obj, <span class="hljs-string">&#x27;jsonpath语法&#x27;</span>)<br>	<span class="hljs-comment">#json只能解析本地文件 ，不能解析服务器文件</span><br>    <br></code></pre></td></tr></table></figure>

<p>教程连接（<a target="_blank" rel="noopener" href="http://blog.csdn.net/luxideyao/article/details/77802389%EF%BC%89">http://blog.csdn.net/luxideyao/article/details/77802389）</a></p>
<p><img src="https://s2.loli.net/2024/02/24/2tjg9HyT7iBXvKe.png" srcset="/img/loading.gif" lazyload alt="image-20220112221858720"></p>
<h3 id="BeautifulSoup"><a href="#BeautifulSoup" class="headerlink" title="BeautifulSoup"></a>BeautifulSoup</h3><h4 id="1-基本简介"><a href="#1-基本简介" class="headerlink" title="1.基本简介"></a>1.基本简介</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>BeautifulSoup简称：<br>	bs4<br><span class="hljs-number">2.</span>什么是BeatifulSoup？<br>	BeautifulSoup，和lxml一样，是一个html的解析器，主要功能也是解析和提取数据<br><span class="hljs-number">3.</span>优缺点？<br>    缺点：效率没有lxml的效率高<br>    优点：接口设计人性化，使用方便<br><br></code></pre></td></tr></table></figure>

<h4 id="2-安装以及创建"><a href="#2-安装以及创建" class="headerlink" title="2.安装以及创建"></a>2.安装以及创建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>安装<br>	pip install bs4<br>    安装解析器lxml（第三方解析器）<br>    pip install lxml<br><span class="hljs-number">2.</span>导入<br>	<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-number">3.</span>创建对象<br>	服务器响应的文件生成对象<br>		soup = BeautifulSoup(response.read().decode(), <span class="hljs-string">&#x27;lxml&#x27;</span>)<br>	本地文件生成对象<br>		soup = BeautifulSoup(<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;1.html&#x27;</span>), <span class="hljs-string">&#x27;lxml&#x27;</span>)<br>注意：默认打开文件的编码格式gbk所以需要指定打开编码格式<br></code></pre></td></tr></table></figure>

<h4 id="3-节点定位"><a href="#3-节点定位" class="headerlink" title="3.节点定位"></a>3.节点定位</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>根据标签名查找节点<br>		soup.a 【注】只能找到第一个a<br>			soup.a.name<br>			soup.a.attrs<br><br><span class="hljs-number">2.</span>函数<br>        (<span class="hljs-number">1</span>).find(返回一个对象)<br>                find(<span class="hljs-string">&#x27;a&#x27;</span>)：只找到第一个a标签<br>        		find(<span class="hljs-string">&#x27;a&#x27;</span>, title=<span class="hljs-string">&#x27;名字&#x27;</span>)<br>        		find(<span class="hljs-string">&#x27;a&#x27;</span>, class_=<span class="hljs-string">&#x27;名字&#x27;</span>)<br>        (<span class="hljs-number">2</span>).find_all(返回一个列表)<br>        		find_all(<span class="hljs-string">&#x27;a&#x27;</span>) 查找到所有的a<br>        		find_all([<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;span&#x27;</span>]) 返回所有的a和span<br>        		find_all(<span class="hljs-string">&#x27;a&#x27;</span>, limit=<span class="hljs-number">2</span>) 只找前两个a<br><span class="hljs-comment">#如果想获取的是多个标签的数据 那么需要在find_all中添加的参数为列表的参数 </span><br>		(<span class="hljs-number">3</span>).select(根据选择器得到节点对象)【推荐】<br>                <span class="hljs-number">1.</span>element<br>                	eg:p<br>                <span class="hljs-number">2.</span>.<span class="hljs-keyword">class</span>  <span class="hljs-comment">#类选择器  .</span><br>                	eg:<span class="hljs-built_in">print</span>(soup.select(<span class="hljs-string">&#x27;.a1&#x27;</span>))<br>                <span class="hljs-number">3.</span><span class="hljs-comment">#id     #id选择器</span><br>               		eg:<span class="hljs-built_in">print</span>(soup.select(<span class="hljs-string">&#x27;#l1&#x27;</span>))<br>                <br>                <span class="hljs-number">4.</span>属性选择器<br>                	<span class="hljs-comment">#属性选择器 -- 通过属性寻找对应标签</span><br>                    [attribute]<br>                    	eg:li = soup.select(<span class="hljs-string">&#x27;li[class]&#x27;</span>)<br>                    [attribute=value]<br>                    	eg:li = soup.select(<span class="hljs-string">&#x27;li[class=&quot;mm1&quot;]&#x27;</span>)<br>                <span class="hljs-number">5.</span>层级选择器<br>                element element 后代选择器 (空格)<br>                	div p<br>                element&gt;element  子代选择器(&gt;)<br>                	div&gt;p<br>                    soup.select(<span class="hljs-string">&#x27;div&gt;ul&gt;li&#x27;</span>)<br>                element,element  (,) 并列两个标签   <br>                	div,p<br>                    soup.select(<span class="hljs-string">&#x27;a,li&#x27;</span>)<br>                eg:soup = soup.select(<span class="hljs-string">&#x27;a,span&#x27;</span>)<br>        <br></code></pre></td></tr></table></figure>

<h4 id="4-节点信息"><a href="#4-节点信息" class="headerlink" title="4.节点信息"></a>4.节点信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">(<span class="hljs-number">1</span>).获取节点内容：适用于标签中嵌套标签的结构<br>        obj.string<br>        obj.get_text()【推荐】<br><span class="hljs-comment"># 如果标签对象中  只有内容那么string和get_text()都可以使用</span><br><span class="hljs-comment"># 如果标签对象中，除了内容还有标签那么只有get_text()可以使用        </span><br>(<span class="hljs-number">2</span>).节点的属性<br>    tag.name 获取标签名<br>        eg:tag = find(<span class="hljs-string">&#x27;li)</span><br><span class="hljs-string">            print(tag.name)</span><br><span class="hljs-string">   	tag.attrs将属性值作为一个字典返回</span><br><span class="hljs-string">(3).获取节点属性</span><br><span class="hljs-string">        obj.attrs.get(&#x27;</span>title<span class="hljs-string">&#x27;)【常用】</span><br><span class="hljs-string">        obj.get(&#x27;</span>title<span class="hljs-string">&#x27;) </span><br><span class="hljs-string">        obj[&#x27;</span>title<span class="hljs-string">&#x27;]</span><br></code></pre></td></tr></table></figure>

<h2 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h2><h3 id="selenium"><a href="#selenium" class="headerlink" title="selenium"></a>selenium</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>什么是selenium？<br>    （<span class="hljs-number">1</span>）Selenium是一个用于Web应用程序测试的工具。<br>    （<span class="hljs-number">2</span>）Selenium 测试<span class="hljs-string">&#x27;直接运行&#x27;</span>在浏览器中，就像真正的用户在操作一样。<br>    （<span class="hljs-number">3</span>）支持通过各种driver（FirfoxDriver，IternetExplorerDriver，OperaDriver，ChromeDriver）驱动真实浏览器完成测试。<br>	（<span class="hljs-number">4</span>）selenium也是支持无界面浏览器操作的。<br><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">2.</span>为什么使用selenium？<br>	模拟浏览器功能，自动执行网页中的js代码，实现动态加载<br>    <br>eg. 京东秒杀 <span class="hljs-built_in">id</span> = <span class="hljs-string">&#x27;J_seckill&#x27;</span> 的数据 是由js渲染出来的，而js要在浏览器中运行，直接openurl无法使用，所以引入了selenium<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">3.</span>如何安装selenium？<br>	(<span class="hljs-number">1</span>)下载浏览器引擎<br>		Microsoft Edge<br>		https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/<br>	(<span class="hljs-number">2</span>)安装 selenium<br>		pip install selenium<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">pycparser, cffi, attrs, sortedcontainers, sniffio, six, outcome, h11, cryptography, <span class="hljs-keyword">async</span>-generator, wsproto, trio, pyOpenSSL, trio-websocket, selenium<br>安装selenium产生的依赖库<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">4.</span>selenium 使用步骤<br><br><span class="hljs-comment"># (1)导入selenium</span><br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><span class="hljs-comment"># (2) 创建浏览器的操作对象</span><br>path = <span class="hljs-string">&#x27;msedgedriver.exe&#x27;</span><br>browser = webdriver.Edge(path)  <span class="hljs-comment"># 注意 Edge &#x27;E&#x27;必须大写 否则会出现TypeError:&#x27;module&#x27; object is not callable(模块对象不可调用)</span><br><br><span class="hljs-comment">#访问网站</span><br>url = <span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span><br>browser.get(url)<br></code></pre></td></tr></table></figure>

<h4 id="元素定位"><a href="#元素定位" class="headerlink" title="元素定位"></a>元素定位</h4><p>selenium的元素定位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">元素定位：自动化要做的就是模拟鼠标和键盘来操作来操作这些元素，点击、输入等等。操作这些元素前首先要找到它们，WebDriver提供很多定位元素的方法<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">方法：<br><span class="hljs-number">1.</span>find_element_by_id	<span class="hljs-comment">#根据id来找到对象</span><br>	eg:button = browser.find_element_by_id(<span class="hljs-string">&#x27;su&#x27;</span>)<br>        <br><span class="hljs-number">2.</span>find_elements_by_name	<span class="hljs-comment">#根据标签属性的属性值来获取对象的</span><br>	eg:name = browser.find_element_by_name(<span class="hljs-string">&#x27;wd&#x27;</span>)<br>        <br><span class="hljs-number">3.</span>find_elements_by_xpath	<span class="hljs-comment">#根据xpath语句来获取对象</span><br>	eg:xpath1 = browser.find_elements_by_xpath(<span class="hljs-string">&#x27;//input[@id=&quot;su&quot;]&#x27;</span>)<br>        <br><span class="hljs-number">4.</span>find_elements_by_tag_name	<span class="hljs-comment">#根据标签的名字来获取对象</span><br>	eg:names = browser.find_elements_by_tag_name(<span class="hljs-string">&#x27;input&#x27;</span>)<br>        <br><span class="hljs-number">5.</span>find_elements_by_css_selector	<span class="hljs-comment">#使用的是bs4的语法来获取对象</span><br>	eg:my_input = browser.find_elements_by_css_selector(<span class="hljs-string">&#x27;#kw&#x27;</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-number">6.</span>find_elements_by_link_text	<span class="hljs-comment">#获取连接文本  及标签为a的</span><br>	eg:browser.find_element_by_link_text(<span class="hljs-string">&quot;新闻&quot;</span>)<br><br><span class="hljs-string">&#x27;注：_element_ 与 _elements_ 区别：&#x27;</span>s<span class="hljs-string">&#x27;是以列表形式返回值&#x27;</span><br></code></pre></td></tr></table></figure>

<h4 id="访问元素信息"><a href="#访问元素信息" class="headerlink" title="访问元素信息"></a>访问元素信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">获取元素属性<br>	.get_attribute(<span class="hljs-string">&#x27;class&#x27;</span>)<br>获取元素文本	<span class="hljs-comment">#表情头和标签尾中间的内容</span><br>	.text<br>获取标签名<br>	.tag_name<br></code></pre></td></tr></table></figure>

<h4 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h4><h4 id="handless"><a href="#handless" class="headerlink" title="handless"></a>handless</h4><p>无界面使用</p>
<h2 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h2><p>只属于python，其他编程语言没有</p>
<h3 id="urllib和request的区别"><a href="#urllib和request的区别" class="headerlink" title="urllib和request的区别"></a>urllib和request的区别</h3><p>urllib</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>一个类型和六个方法<br><span class="hljs-number">2.</span>get请求 <br>	urllib.parse.quote<br>    urllib.parse.urlencode<br>        两种方法处理url中,（无法识别中文）中文的编解码问题 <br>            quote处理单个参数的解码，转化为unicode编码<br>            urlencode处理date数据（多个数据）的解码<br><span class="hljs-number">3.</span>post请求 	百度翻译<br><span class="hljs-number">4.</span>ajax的get请求<br><span class="hljs-number">5.</span>ajax的post请求<br><span class="hljs-number">6.</span>cookie登录 <br><span class="hljs-number">7.</span>代理<br></code></pre></td></tr></table></figure>

<p>request</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>一个类型及<span class="hljs-number">6</span>个属性<br><span class="hljs-number">2.</span>get请求<br><span class="hljs-number">3.</span>post请求<br><span class="hljs-number">4.</span>代理<br><span class="hljs-number">5</span>，cookie  破解验证码<br></code></pre></td></tr></table></figure>

<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>文档：<br>官方文档<br>http://cn.python‐requests.org/zh_CN/latest/<br>快速上手<br>http://cn.python‐requests.org/zh_CN/latest/user/quickstart.html<br><br>测试地址：http://httpbin.org<br></code></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">2.</span>安装<br>	pip install request<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">3.</span>request 的属性及类型<br><span class="hljs-comment">#一个类型 6个属性</span><br>	类型				:models.Response<br>	r.text 			:获取网页源码（以字符串形式返回）<br>	r.encoding		:设置响应的编码格式<br>	r.url			:获取请求的url<br>	r.content		:获取二进制的数据（用来下载照片等文件）<br>	r.status_code	：获取响应的状态码<br>	r.headers		:获取相应头的信息<br>        <br><span class="hljs-comment">#encoding使用</span><br>requests的猜测解码方式和网页真正的编码方式不一致导致会出现乱码<br>则需手动指定requests的解码方式<br>	response.encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span><br>response.apparent_encoding  <span class="hljs-comment">#获取网页编码格式</span><br>	response.encoding = response.apparent_encoding<br></code></pre></td></tr></table></figure>

<h3 id="get请求"><a href="#get请求" class="headerlink" title="get请求"></a>get请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#总结：</span><br> <span class="hljs-number">1.</span>参数使用params传递<br> <span class="hljs-number">2.</span>参数无需使用urlencode编码<br> <span class="hljs-number">3.</span>不需要请求对象的定制<br> <span class="hljs-number">4.</span>请求资源路径中的<span class="hljs-string">&#x27;?&#x27;</span>可以加也可以不加<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;https://www.baidu.com/s&#x27;</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Mobile Safari/537.36 Edg/97.0.1072.55&#x27;</span><br>&#125;<br><br>data = &#123;<br>    <span class="hljs-string">&#x27;wd&#x27;</span>:<span class="hljs-string">&#x27;西安&#x27;</span><br>&#125;<br><br><span class="hljs-comment">#get属性 可以传递的参数</span><br><span class="hljs-comment">#url 请求资源路径</span><br><span class="hljs-comment">#params 参数 类型any不限 不需要编码</span><br><span class="hljs-comment">#headers 头部         #可以直接传递，所以不需要请求头部的定制</span><br><span class="hljs-comment">#kwargs 字典</span><br>response = requests.get(url=url,params=data,headers=headers)<br>content = response.text<br><br><span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure>

<h3 id="post请求"><a href="#post请求" class="headerlink" title="post请求"></a>post请求</h3><p>urllib中需要先urlencode 解码encode编码，在进行请求对象调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 总结</span><br><span class="hljs-number">1.</span>post请求 不需要编解码<br><span class="hljs-number">2.</span>post请求的参数是data<br><span class="hljs-number">3.</span>不需要请求对象的定制<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;https://fanyi.baidu.com/sug&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36 Edg/97.0.1072.69&#x27;</span>,&#125;<br><br><span class="hljs-comment"># keyword = input(&quot;请输入要翻译的内容:&quot;)</span><br>data = &#123;<br>    <span class="hljs-string">&#x27;kw&#x27;</span>:<span class="hljs-string">&#x27;spider&#x27;</span><br>&#125;<br><br><span class="hljs-comment">#post属性 可以传递的参数</span><br><span class="hljs-comment">#url 请求资源路径</span><br><span class="hljs-comment">#data 参数</span><br><span class="hljs-comment">#json</span><br><span class="hljs-comment">#kwargs 字典</span><br>response =requests.post(url=url ,data= data, headers= headers)<br><br>content = response.text<br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-comment"># obj = json.loads(content,encoding=&#x27;utf-8&#x27;) #弃用错误</span><br>obj = json.loads(content.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)) <span class="hljs-comment">#使用response自身的属性即可</span><br><span class="hljs-built_in">print</span>(obj)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">get</span>和<span class="hljs-built_in">post</span>区别？<br>    <span class="hljs-number">1</span>： <span class="hljs-built_in">get</span>请求的参数名字是<span class="hljs-built_in">params</span> <span class="hljs-built_in">post</span>请求的参数的名字是data<br>    <span class="hljs-number">2</span>： 请求资源路径后面可以不加?<br>    <span class="hljs-number">3</span>： 不需要手动编解码<br>    <span class="hljs-number">4</span>： 不需要做请求对象的定制<br></code></pre></td></tr></table></figure>



<h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">proxy定制 代理池<br>	在请求中设置proxies参数<br>	<br>proxy = &#123;  <br><span class="hljs-string">&#x27;http&#x27;</span>:<span class="hljs-string">&#x27;219.149.59.250:9797&#x27;</span><br>&#125;<br>requests.get(url=url,params=data,headers=headers,proxies=proxy)<br><br></code></pre></td></tr></table></figure>

<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>初识 验证码登录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#requests中一个个方法 session() 通过session的返回值，将请求变为一个对象</span><br><span class="hljs-comment">#可以保持两次访问在 属于一次大访问之下（验证码访问和提交验证码访问）</span><br></code></pre></td></tr></table></figure>

<h3 id="参数详情"><a href="#参数详情" class="headerlink" title="参数详情"></a>参数详情</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">requests.request(method,url,**kwargs）<br>• method：请求方法，常见有GET、POST请求【此外还有HEAD、PUT、<br>PATCH、DELETE、OPTIONS】（前<span class="hljs-number">6</span>种就是HTTP协议所对应的请求方式，OPTIONS事实上是向服务器获取一些服务器跟客户端能够打交道的参数）<br>• url：请求的URL地址<br>•**kwargs：是一个可变的参数类型，在传实参时，以关键字参数的形式传入，python会自动解析成字典的形式<br>                 <br><span class="hljs-number">1.</span> params : 字典或元组列表或字节，作为参数增加到url中；一般用于get请<br>求，post请求也可用(不常用)。<br><span class="hljs-number">2.</span> data : 字典，元组列表，字节或文件对象,作为post请求的参数。<br><span class="hljs-number">3.</span> json : JSON格式的数据，作为post请求的json参数。<br><span class="hljs-number">4.</span> headers : 字典类型, HTTP请求头信息。<br><span class="hljs-number">5.</span> cookies : 字典或CookieJar，Request中的auth : 元组支持HTTP认证功能<br><span class="hljs-number">6.</span> files : 字典类型，传输文件，作为post请求文件流数据。<br><span class="hljs-number">7.</span> timeout : 设定超时时间，秒为单位<br><span class="hljs-number">8.</span> proxies : 字典类型，设定访问代理服务器，可以增加登录认证<br><span class="hljs-number">9.</span> allow_redirects : <span class="hljs-literal">True</span>/<span class="hljs-literal">False</span>，默认为<span class="hljs-literal">True</span>，重定向开关<br><span class="hljs-number">10.</span> stream : <span class="hljs-literal">True</span>/<span class="hljs-literal">False</span>，默认为<span class="hljs-literal">True</span>，获取内容立即下载开关<br><span class="hljs-number">11.</span> verify : <span class="hljs-literal">True</span>/<span class="hljs-literal">False</span>，默认为<span class="hljs-literal">True</span>，认证SSL证书开关<br><span class="hljs-number">12.</span> cert : 本地SSL证书<br><span class="hljs-number">13.</span> auth : 元组，支持HTTP认证功能<br>                 <br><span class="hljs-comment">#params、data、json区别：</span><br>params：get请求 中接收参数，params=字典类型的数据<br>data：post请求中接收参数，data=字典格式的数据（content_type为键值对的编码格式）<br>json：post请求中接收参数，json=字典格式的数据（content_type为application/json），使用json接收会自动将字典转换为json；也可以用data接收json格式的数据，data=json.dump(字典格式的数据)<br></code></pre></td></tr></table></figure>

<h2 id="Scrapy"><a href="#Scrapy" class="headerlink" title="Scrapy"></a>Scrapy</h2><h3 id="1-scrapy"><a href="#1-scrapy" class="headerlink" title="1.scrapy"></a>1.scrapy</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">（<span class="hljs-number">1</span>）scrapy是什么？<br>Scrapy是一个为了爬取网站数据，提取结构性数据而编写的<span class="hljs-string">&#x27;应用框架&#x27;</span>。 可以应用在包括数据挖掘，信息处理或存储历史数据等一系列的程序中。<br></code></pre></td></tr></table></figure>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#使用国内源</span><br>pip install scrapy -i https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Successfully</span> built protego PyDispatcher<br><span class="hljs-attribute">Installing</span> collected packages: twisted-iocpsupport, PyDispatcher, pyasn1, priority, incremental, hyperframe, hpack, constantly, zope.interface, w3lib, typing-extensions, queuelib, pyasn1-modules, protego, jmespath, itemadapter, hyperlink, h2, cssselect, Automat, Twisted, parsel, service-identity, itemloaders, scrapy<br><br><span class="hljs-attribute">Successfully</span> installed Automat-<span class="hljs-number">20</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span> PyDispatcher-<span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5</span> Twisted-<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span> constantly-<span class="hljs-number">15</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span> cssselect-<span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span> h2-<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span> hpack-<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> hyperframe-<span class="hljs-number">5</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span> hyperlink-<span class="hljs-number">21</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> incremental-<span class="hljs-number">21</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span> itemadapter-<span class="hljs-number">0</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span> itemloaders-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span> jmespath-<span class="hljs-number">0</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span> parsel-<span class="hljs-number">1</span>.<span class="hljs-number">6</span>.<span class="hljs-number">0</span> priority-<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span> protego-<span class="hljs-number">0</span>.<span class="hljs-number">1</span>.<span class="hljs-number">16</span> pyasn1-<span class="hljs-number">0</span>.<span class="hljs-number">4</span>.<span class="hljs-number">8</span> pyasn1-modules-<span class="hljs-number">0</span>.<span class="hljs-number">2</span>.<span class="hljs-number">8</span> queuelib-<span class="hljs-number">1</span>.<span class="hljs-number">6</span>.<span class="hljs-number">2</span> scrapy-<span class="hljs-number">2</span>.<span class="hljs-number">5</span>.<span class="hljs-number">1</span> service-identity-<span class="hljs-number">21</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span> twisted-iocpsupport-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span> typing-extensions-<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> w3lib-<span class="hljs-number">1</span>.<span class="hljs-number">22</span>.<span class="hljs-number">0</span> zope.interface-<span class="hljs-number">5</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<p>可能出现的错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">报错<span class="hljs-number">1</span>：<br>	pip install Scrapy<br>    building <span class="hljs-string">&#x27;twisted.test.raiser&#x27;</span> extension<br>    error: Microsoft Visual C++ <span class="hljs-number">14.0</span> <span class="hljs-keyword">is</span> required. Get it <span class="hljs-keyword">with</span> <span class="hljs-string">&quot;Microsoft Visual C++Build Tools&quot;</span>:http://landinghub.visualstudio.com/visual‐cpp‐build‐tools<br><br>解决方案：<br>    http://www.lfd.uci.edu/~gohlke/pythonlibs/<span class="hljs-comment">#twisted</span><br>    下载twisted对应版本的whl文件（如我的Twisted‐<span class="hljs-number">17.5</span><span class="hljs-number">.0</span>‐cp36‐cp36m‐win_amd64.whl），cp后面是python版本，amd64代表<span class="hljs-number">64</span>位，<br>    运行命令：<br>    pip install C:\Users\...\Twisted‐<span class="hljs-number">17.5</span><span class="hljs-number">.0</span>‐cp36‐cp36m‐win_amd64.whl<br>    pip install Scrapy<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">实在不行使用<span class="hljs-string">&#x27;anaconda&#x27;</span>下载   <span class="hljs-comment">#会下载许多目前用不到的包</span><br>	pycharm 需要将环境变量更改为 anaconda的环境<br>    使用步骤：<br>        打开anaconda<br>        点击environments<br>        点击<span class="hljs-keyword">not</span> installed<br>        输入scrapy<br>        apply<br>        在pycharm中选择anaconda的环境<br></code></pre></td></tr></table></figure>

<h4 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h4><p>scrapy项目的创建以及运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>创建scrapy项目：<br>		终端输入 scrapy startproject 项目名称<br>		<span class="hljs-comment">#名称不能以 数字开头，也不能包含中午</span><br><br><span class="hljs-number">2.</span>创建爬虫文件<br>		要在spiders文件夹中创建爬虫文件<br>    	cd 项目的名字\项目的名字\spiders<br>        <br>        创建爬虫文件<br>        	scrapy  genspider 爬虫文件的名字  要爬取的网页<br>            eg. scrapy genspider baidu  www.baidu.com<br>            	<span class="hljs-comment">#网页url 不需要添加http协议</span><br><span class="hljs-number">3.</span> 运行爬虫代码<br>		scrapy crawl 爬虫的名字<br>    	eg. scrapy crawl baidu<br>        <br>        <span class="hljs-comment">#需要修改robots.txt 协议</span><br>        在settings.py中修改,将ROBOTSTXT_OBEY = <span class="hljs-literal">True</span>注释掉<br></code></pre></td></tr></table></figure>

<h4 id="scrapy项目的结构"><a href="#scrapy项目的结构" class="headerlink" title="scrapy项目的结构"></a>scrapy项目的结构</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">项目名字<br>	项目名字<br>		spiders文件夹（存储的是爬虫文件）<br>			__init__<br>			自定义的爬虫文件	由我们自己创建，是实现爬虫核心功能的文件<br><br>		__init__<br>		items			定义数据结构的地方  爬取的数据都包含那些<br>		middleware 		中间件		代理<br>		pipelines 		管道		 用来处理下载的数据<br>		settings 		配置文件	robbts协议 ua定义等<br></code></pre></td></tr></table></figure>

<p>response的属性和方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">爬虫文件的基本组成：<br>	继承scrapy.Spider类<br>        name = <span class="hljs-string">&#x27;baidu&#x27;</span> ‐‐‐》 运行爬虫文件时使用的名字<br>        allowed_domains‐‐‐》 爬虫允许的域名，在爬取的时候，如果不是此域名之下的url，会被过滤掉<br>        start_urls ‐‐‐》声明了爬虫的起始地址，可以写多个url，一般是一个<br>        parse(self, response) ‐‐‐》解析数据的回调函数<br>            response.text ‐‐‐》响应的是字符串<br>            response.body ‐‐‐》响应的是二进制文件（类似content）<br>            response.xpath()‐》xpath方法的返回值类型是selector列表<br>            extract() ‐‐‐》提取的是selector对象的是data<br>            extract_first() ‐‐‐》提取的是selector列表中的第一个数据<br></code></pre></td></tr></table></figure>

<p>解析数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#不需要引入库，直接使用</span><br> span = response.xpath(<span class="hljs-string">&#x27;xpath语句&#x27;</span>) <br> span.extract() 的是selector对象的是data数据<br>		<span class="hljs-comment">#eg.&lt;Selector xpath = &#x27;路径&#x27;,data = &#x27;xxx&#x27;&gt;</span><br> span.extract_first()<br>		获取selector列表第一个数据的data值<br></code></pre></td></tr></table></figure>

<h4 id="scrapy架构组成"><a href="#scrapy架构组成" class="headerlink" title="scrapy架构组成"></a>scrapy架构组成</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">（<span class="hljs-number">1</span>）引擎 ‐‐‐》自动运行，无需关注，会自动组织所有的请求对象，分发给下载器<br>（<span class="hljs-number">2</span>）下载器 ‐‐‐》从引擎处获取到请求对象后，请求数据<br>（<span class="hljs-number">3</span>）<span class="hljs-variable">spiders</span> ‐‐‐》<span class="hljs-variable">Spider</span>类定义了如何爬取某个<span class="hljs-punctuation">(</span>或某些<span class="hljs-punctuation">)</span>网站。包括了爬取的动作<span class="hljs-punctuation">(</span>例如<span class="hljs-operator">:</span>是否跟进链接<span class="hljs-punctuation">)</span>以及如何从网页的内容中提取结构化数据<span class="hljs-punctuation">(</span>爬取<span class="hljs-variable">item</span><span class="hljs-punctuation">)</span>。 换句话说，<span class="hljs-variable">Spider</span>就是您定义爬取的动作及分析某个网页<span class="hljs-punctuation">(</span>或者是有些网页<span class="hljs-punctuation">)</span>的地方。<br>（<span class="hljs-number">4</span>）调度器 ‐‐‐》有自己的调度规则，无需关注<br>（<span class="hljs-number">5</span>）管道（<span class="hljs-built_in">Item</span> <span class="hljs-variable">pipeline</span>） ‐‐‐》最终处理数据的管道，会预留接口供我们处理数据当<span class="hljs-built_in">Item</span>在<span class="hljs-variable">Spider</span>中被收集之后，它将会被传递到<span class="hljs-built_in">Item</span> <span class="hljs-variable">Pipeline</span>，一些组件会按照一定的顺序执行对<span class="hljs-built_in">Item</span>的处理。<br><br>每个<span class="hljs-variable">item</span> <span class="hljs-variable">pipeline</span>组件<span class="hljs-punctuation">(</span>有时称之为“<span class="hljs-built_in">Item</span> <span class="hljs-variable">Pipeline</span>”<span class="hljs-punctuation">)</span>是实现了简单方法的<span class="hljs-variable">Python</span>类。他们接收到<span class="hljs-built_in">Item</span>并通过它执行一些行为，同时也决定此<span class="hljs-built_in">Item</span>是否继续通过<span class="hljs-variable">pipeline</span>，或是被丢弃而不再进行处理。<br>        以下是<span class="hljs-variable">item</span> <span class="hljs-variable">pipeline</span>的一些典型应用：<br>        <span class="hljs-number">1.</span> 清理<span class="hljs-variable">HTML</span>数据<br>        <span class="hljs-number">2.</span> 验证爬取的数据<span class="hljs-punctuation">(</span>检查<span class="hljs-variable">item</span>包含某些字段<span class="hljs-punctuation">)</span><br>        <span class="hljs-number">3.</span> 查重<span class="hljs-punctuation">(</span>并丢弃<span class="hljs-punctuation">)</span><br>        <span class="hljs-number">4.</span> 将爬取结果保存到数据库中<br><br></code></pre></td></tr></table></figure>

<h4 id="scrapy工作原理"><a href="#scrapy工作原理" class="headerlink" title="scrapy工作原理"></a>scrapy工作原理</h4><img src="https://s2.loli.net/2024/02/24/Ad7SgLB1I6cGV9m.png" srcset="/img/loading.gif" lazyload alt="image-20220213142311558"  />

<h3 id="scrapy-shell"><a href="#scrapy-shell" class="headerlink" title="scrapy shell"></a>scrapy shell</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1.</span>什么是scrapy shell？<br>Scrapy终端，是一个交互终端，供您在未启动spider的情况下尝试及调试您的爬取代码。 其本意是用来测试提取数据的代码，不过您可以将其作为正常的Python终端，在上面测试任何的Python代码。<br>该终端是用来测试XPath或CSS表达式，查看他们的工作方式及从爬取的网页中提取的数据。 在编写您的spider时，该终端提供了交互性测试您的表达式代码的功能，免去了每次修改后运行spider的麻烦。<br>一旦熟悉了Scrapy终端后，您会发现其在开发和调试spider时发挥的巨大作用。<br></code></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">进入到scrapy shell的终端 直接在window的终端中输入<br>		scrapy shell  域名<br><span class="hljs-comment">#如果需要 高亮 或者 自动补全 那么可以安装 ipython</span><br>		pip install ipython<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Python/" class="category-chain-item">Python</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/python/" class="print-no-link">#python</a>
      
        <a href="/tags/%E7%88%AC%E8%99%AB/" class="print-no-link">#爬虫</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Python爬虫</div>
      <div>http://example.com/2020/12/18/Python/爬虫/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Crx</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2020年12月18日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2024年2月24日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/03/05/Linux/Linux/" title="Linux">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Linux</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/09/11/Python/Python/" title="Python">
                        <span class="hidden-mobile">Python</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  var relativeDate = function() {
    var updatedTime = document.getElementById('updated-time');
    if (updatedTime) {
      var text = updatedTime.textContent;
      var reg = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/;
      var matchs = text.match(reg);
      if (matchs) {
        var relativeTime = moment(matchs[0]).fromNow();
        updatedTime.textContent = text.replace(reg, relativeTime);
      }
      updatedTime.style.display = '';
    }
  };
  Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/moment.min.js', function() {
    if (!'zh-cn'.startsWith('en')) {
      Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/locale/zh-cn.min.js', function() {
        relativeDate();
      });
    } else {
      relativeDate();
    }
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
